# Milestone v2.0: TSX Syntax Improvements

**Status:** SHIPPED 2026-01-27
**Phases:** 20-25
**Total Plans:** 17

## Overview

Improve TSX authoring ergonomics with better module organization, semantic components for common patterns, structured props for tables/lists, and render props pattern for context access.

## Phases

### Phase 20: Module Restructure

**Goal**: Split jsx.ts (1044 lines) into organized primitives/ and workflow/ directories with clean re-exports
**Depends on**: Phase 19 (v1.8 complete)
**Plans**: 2 plans

Plans:
- [x] 20-01: Create primitives/ and workflow/ directories with all component files
- [x] 20-02: Rewrite jsx.ts with re-exports and verify build/tests pass

**Details:**
- Split jsx.ts from 1044 lines to 107 lines (91% reduction)
- primitives/ uses lowercase filenames (markdown.ts, control.ts)
- workflow/ uses PascalCase filenames (Command.ts, Agent.ts)
- 59 named exports maintained with zero breaking changes
- NodeNext-compliant module structure

### Phase 21: Structured Props

**Goal**: Add Table and List components that accept structured array props instead of manual JSX children
**Depends on**: Phase 20
**Plans**: 2 plans

Plans:
- [x] 21-01: Table and List IR nodes and JSX types
- [x] 21-02: Table and List transformer and emitter implementation

**Details:**
- Table with headers, rows, align, emptyCell props
- List with items, ordered, start props
- Markdown table generation with alignment markers
- Pipe character escaping and newline handling
- Numeric literal parsing for start attribute

### Phase 22: Semantic Components

**Goal**: Add semantic section components that emit XML-wrapped content for common Claude Code patterns
**Depends on**: Phase 21
**Plans**: 4 plans

Plans:
- [x] 22-01: ExecutionContext, SuccessCriteria, XmlSection components and IR nodes
- [x] 22-02: OfferNext component with typed routes and XML wrapper components
- [x] 22-03: Transformer implementation for all semantic components
- [x] 22-04: Emitter implementation and end-to-end verification

**Details:**
- ExecutionContext with paths prop and @ prefix
- SuccessCriteria with checkbox list generation
- OfferNext with typed route objects
- DeviationRules, CommitRules, WaveExecution, CheckpointHandling wrappers
- AST-based object array parsing for complex props

### Phase 23: Context Access Patterns

**Goal**: Enable render props pattern for context access and explicit generics on workflow components
**Depends on**: Phase 22
**Plans**: 3 plans

Plans:
- [x] 23-01: Command and Agent render props support (CTX-01, CTX-02)
- [x] 23-02: Explicit generics on workflow components (CTX-03)
- [x] 23-03: Step component for numbered sections (CTX-04)

**Details:**
- CommandContext includes name, description, skill, outputPath, sourcePath
- AgentContext extends CommandContext with tools, model
- If<T>, Loop<T> with explicit generic type parameters
- Step component with heading/bold/xml variants
- Single parameter detection for render props pattern

### Phase 24: Parser/Emitter Integration

**Goal**: Wire all new components through transformer and emitter with comprehensive tests
**Depends on**: Phase 23
**Plans**: 3 plans

Plans:
- [x] 24-01: Unit verification tests for Table, List, and semantic components
- [x] 24-02: Control flow tests (Loop, OnStatus, Step) and v2.0 integration test
- [x] 24-03: Documentation updates for all v2.0 components

**Details:**
- src/app/verification/ directory for permanent test infrastructure
- 6 test files covering all edge cases
- integration-v2.tsx demonstrating all components together
- 1,130 lines of new documentation
- TSX -> markdown transformation examples throughout

### Phase 25: TSX Test Modernization

**Goal**: Update all TSX test files in src/app/ to use new v2.0 syntax features
**Depends on**: Phase 24
**Plans**: 3 plans

Plans:
- [x] 25-01: Update scenario files with Table and List components
- [x] 25-02: Update scenario files with semantic components (ExecutionContext, SuccessCriteria, Step)
- [x] 25-03: Render props in Agent + enhance release command with OfferNext

**Details:**
- 16+ scenario test files modernized
- Render props demonstrated in both Command and Agent
- OfferNext routes replace manual XmlBlock in release command
- Real-world usage patterns established

---

## Milestone Summary

**Key Decisions:**

- Module restructure uses explicit named re-exports (not export *) for tree-shaking
- Type-only exports marked with `type` keyword per TypeScript 5.x best practices
- Pipe characters in table cells escaped as `\|` to prevent syntax breakage
- Step number stored as string to support sub-steps like "1.1"
- Render props documented as optional pattern (progressive disclosure)
- Separate documentation files for structured vs semantic components

**Issues Resolved:**

- jsx.ts monolith (1044 lines) split into maintainable modules
- Manual markdown for tables/lists replaced with structured props
- Context access in Command/Agent enabled via render props
- Step component added for numbered workflow sections

**Technical Debt Incurred:**

- Render props context interpolation emits literal variable names (static compilation constraint)
- Table emptyCell prop shows null/undefined literal instead of placeholder

---

_For current project status, see .planning/ROADMAP.md_

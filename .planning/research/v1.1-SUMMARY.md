# Project Research Summary: v1.1 Agent Framework

**Project:** react-agentic v1.1 (Agent Framework)
**Domain:** TSX-to-Markdown Transpiler - Agent Extension
**Researched:** 2026-01-21
**Confidence:** HIGH

## Executive Summary

This milestone adds Agent components and Command→Agent communication to the existing TSX transpiler. The key architectural insight: we parse typed interfaces at compile time but emit to an untyped format (Markdown). TypeScript safety exists during authoring, not across compiled artifacts.

**No new dependencies required.** The existing ts-morph 27.0.2 and TypeScript 5.9.3 provide all APIs for:
- Generic type extraction from `<Agent<TInput, TOutput>>`
- Cross-file interface resolution
- Type serialization for documentation

The recommended approach: Agent defines and exports its interface, Command imports it, SpawnAgent validates against it at compile time. Output format matches GSD exactly.

## Key Findings

### Stack Additions: NONE

| Technology | Current | Required | Action |
|------------|---------|----------|--------|
| ts-morph | ^27.0.2 | ^27.0.2 | Keep |
| TypeScript | ^5.9.3 | ^5.9.3 | Keep |
| All others | — | — | Keep |

**Key ts-morph APIs for type extraction:**
- `element.getTypeArguments()` → Extract `<TInput, TOutput>` from JSX
- `sourceFile.getInterface(name)` → Get interface declaration
- `importDecl.getModuleSpecifierSourceFile()` → Follow imports

### New Feature Table Stakes

**Agent Component:**
- Frontmatter: `name`, `description`, `tools` (string, not array), `color`
- Section support: `<role>`, `<methodology>`, `<output>` blocks
- Different YAML schema from Command (tools vs allowed-tools)

**SpawnAgent Component:**
- Task() syntax generation: `prompt`, `subagent_type`, `model`, `description`
- Inline context pattern (@ references must NOT be resolved)
- Support for `{variable}` placeholders in prompts

**Type Safety (Differentiator):**
- Agent exports TypeScript interface for input/output
- SpawnAgent validates input props against Agent's interface
- Compile-time contract validation (vs GSD's implicit contracts)

### GSD Format Specification

**Agent Frontmatter:**
```yaml
---
name: gsd-phase-researcher
description: "Researches how to implement a phase"
tools: "Read, Write, Bash, Grep, Glob, WebSearch"
color: cyan
---
```

**Task() Syntax:**
```
Task(
  prompt="<planning_context>...</planning_context>",
  subagent_type="gsd-planner",
  model="{planner_model}",
  description="Create plans"
)
```

**Critical Pattern:** Content does NOT cross Task() boundaries via @ syntax. Must inline content.

### Watch Out For

| Pitfall | Risk | Mitigation |
|---------|------|------------|
| Type info lost at transpilation | HIGH | Accept limitation, focus on compile-time validation |
| Circular dependencies (Agent↔Command) | MEDIUM | Separate type-only imports from component resolution |
| @ references inlined instead of preserved | MEDIUM | Emit verbatim, test round-trip |
| Generic type inference in TSX | MEDIUM | Use import-based typing, not inline generics |
| Whitespace sensitivity in XML blocks | LOW | Snapshot test exact output |

## Implications for Roadmap

### Recommended Phase Structure

**Phase 8: IR Extensions** (Low complexity)
- Add `AgentDocumentNode`, `AgentFrontmatterNode` to IR
- Add `SpawnAgentNode`, `TypeReference` types
- Update discriminated union and assertNever

**Phase 9: Basic Agent Transpilation** (Low-Medium complexity)
- Agent component parsing
- Agent frontmatter emission (GSD format)
- CLI routing: Agent → `.claude/agents/`, Command → `.claude/commands/`

**Phase 10: SpawnAgent Component** (Medium complexity)
- SpawnAgent parsing and transformation
- Task() syntax emission
- Prompt template handling with `{variable}` placeholders

**Phase 11: Type Safety** (High complexity)
- Agent interface extraction/export
- SpawnAgent generic typing with import resolution
- Cross-file contract validation

### Phase Ordering Rationale

1. **IR first** — All other work depends on having the node types
2. **Agent before SpawnAgent** — SpawnAgent references Agents
3. **Basic emission before type safety** — Validate output format matches GSD before adding type complexity
4. **Type safety last** — Highest value but highest risk, de-risk core functionality first

## Confidence Assessment

| Area | Confidence | Notes |
|------|------------|-------|
| Stack (no changes) | HIGH | All APIs verified in ts-morph docs |
| GSD format | HIGH | Verified against actual repository files |
| Type extraction approach | HIGH | Standard ts-morph patterns |
| Cross-file resolution | HIGH | Extends existing v1.0 implementation |
| Type boundary limitations | HIGH | Fundamental TypeScript constraint |

**Overall confidence:** HIGH

## Sources

**PRIMARY (HIGH):**
- ts-morph 27.0.2 documentation (types, type parameters, imports)
- GSD repository (11 agents, 27 commands analyzed)
- Existing react-agentic v1.0 codebase

**SECONDARY (MEDIUM):**
- TypeScript GitHub issues on generic JSX inference
- GSD plan-phase.md, gsd-phase-researcher.md (Task() patterns)

---
*Research completed: 2026-01-21*
*Ready for requirements: yes*

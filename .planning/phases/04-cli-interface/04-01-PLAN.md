---
phase: 04-cli-interface
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/cli/index.ts
  - package.json
autonomous: true

must_haves:
  truths:
    - "User can run `react-agentic --help` and see usage information"
    - "User can run `react-agentic --version` and see current version"
    - "CLI entry point exists and is executable"
  artifacts:
    - path: "src/cli/index.ts"
      provides: "CLI entry point with Commander setup"
      min_lines: 20
      exports: []
    - path: "package.json"
      provides: "bin field pointing to CLI"
      contains: '"react-agentic": "dist/cli/index.js"'
  key_links:
    - from: "src/cli/index.ts"
      to: "package.json"
      via: "version read from pkg"
      pattern: "readFile.*package\\.json"
---

<objective>
Set up CLI entry point with Commander.js for argument parsing, automatic help generation, and version display.

Purpose: Establish the CLI foundation that the build command will plug into. Commander provides automatic --help and --version handling.
Output: Executable CLI with working help and version flags.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-cli-interface/04-RESEARCH.md

Key patterns from research:
- Commander.js ESM pattern with async main()
- Version read from package.json at runtime (stays in sync)
- Subcommand structure for future extensibility
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install CLI dependencies</name>
  <files>package.json</files>
  <action>
Install the three CLI dependencies identified in research:
- commander ^14.0.0 (argument parsing)
- globby ^14.0.0 (glob expansion)
- picocolors ^1.1.1 (terminal colors)

Run: `npm install commander globby picocolors`

These are runtime dependencies, not devDependencies.
  </action>
  <verify>
- `npm ls commander` shows ^14.0.0
- `npm ls globby` shows ^14.0.0
- `npm ls picocolors` shows ^1.1.1
- package.json dependencies section updated
  </verify>
  <done>Dependencies installed and recorded in package.json</done>
</task>

<task type="auto">
  <name>Task 2: Create CLI entry point</name>
  <files>src/cli/index.ts</files>
  <action>
Create `src/cli/index.ts` with Commander.js setup:

```typescript
#!/usr/bin/env node
import { Command } from 'commander';
import { readFile } from 'fs/promises';
import { fileURLToPath } from 'url';
import path from 'path';

async function main() {
  // Read version from package.json (stays in sync)
  const __dirname = path.dirname(fileURLToPath(import.meta.url));
  const pkgPath = path.resolve(__dirname, '../../package.json');
  const pkg = JSON.parse(await readFile(pkgPath, 'utf-8'));

  const program = new Command();

  program
    .name('react-agentic')
    .description('Compile-time safety for Claude Code commands')
    .version(pkg.version);

  // Build command will be added in 04-02
  // program.addCommand(buildCommand);

  program.parse();
}

main().catch((err) => {
  console.error(err.message);
  process.exit(1);
});
```

Key implementation notes:
- Use ESM pattern (import.meta.url for __dirname)
- Async main() wrapper to handle package.json read
- Version from package.json, not hardcoded
- Error handler exits with code 1
- Leave placeholder comment for build command
  </action>
  <verify>
- File exists at src/cli/index.ts
- Contains shebang `#!/usr/bin/env node`
- Contains Commander import
- Contains version read from package.json
  </verify>
  <done>CLI entry point created with Commander setup</done>
</task>

<task type="auto">
  <name>Task 3: Update tsup config for CLI entry point</name>
  <files>tsup.config.ts</files>
  <action>
Create or update `tsup.config.ts` to build both library and CLI entry points:

```typescript
import { defineConfig } from 'tsup';

export default defineConfig({
  entry: {
    index: 'src/index.ts',
    'cli/index': 'src/cli/index.ts',
  },
  format: ['esm'],
  dts: true,
  sourcemap: true,
  clean: true,
  target: 'node18',
});
```

Note: Do NOT add banner with shebang in tsup config - the shebang is already in the source file and will be preserved. Adding it in tsup would duplicate it.

The bin field in package.json already points to `dist/cli/index.js` (verified in existing package.json).
  </action>
  <verify>
- tsup.config.ts exists
- Contains both 'index' and 'cli/index' entry points
- `npm run build` succeeds
- dist/cli/index.js exists after build
  </verify>
  <done>tsup configured to build CLI entry point</done>
</task>

</tasks>

<verification>
After all tasks:
1. Run `npm run build` - should succeed
2. Run `node dist/cli/index.js --help` - should show:
   ```
   Usage: react-agentic [options]

   Compile-time safety for Claude Code commands

   Options:
     -V, --version  output the version number
     -h, --help     display help for command
   ```
3. Run `node dist/cli/index.js --version` - should show `0.1.0`
</verification>

<success_criteria>
- `react-agentic --help` displays usage information with program description
- `react-agentic --version` displays version from package.json (0.1.0)
- CLI entry point is built to dist/cli/index.js
- All dependencies installed (commander, globby, picocolors)
</success_criteria>

<output>
After completion, create `.planning/phases/04-cli-interface/04-01-SUMMARY.md`
</output>

---
phase: 25-tsx-test-modernization
plan: 03
type: execute
wave: 2
depends_on: ["25-01", "25-02"]
files_modified:
  - src/app/scenarios/5.1-echo-agent.tsx
  - src/app/release/release.command.tsx
  - src/app/test-render-props.tsx
autonomous: true

must_haves:
  truths:
    - "Render props pattern demonstrated in at least one Agent"
    - "OfferNext component used in release command"
    - "Table component used in release command for structured data"
  artifacts:
    - path: "src/app/scenarios/5.1-echo-agent.tsx"
      provides: "Agent with render props pattern"
      contains: "{(ctx) =>"
    - path: "src/app/release/release.command.tsx"
      provides: "Release command with OfferNext and Table"
      contains: ["<OfferNext", "<Table"]
    - path: "src/app/test-render-props.tsx"
      provides: "Enhanced render props demo with context interpolation"
      contains: "ctx.name"
  key_links:
    - from: "src/app/scenarios/5.1-echo-agent.tsx"
      to: "src/jsx.js"
      via: "import { Agent }"
      pattern: "Agent.*\\{\\(ctx\\)"
---

<objective>
Demonstrate render props pattern in Agent and enhance real-world files with v2.0 features

Purpose: Show render props in an Agent (currently only demonstrated in Commands), and modernize the release command with OfferNext, Table, and semantic components.

Output: 3 updated files demonstrating render props in Agent and v2.0 features in a real-world command
</objective>

<execution_context>
@/Users/glenninizan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/glenninizan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@docs/semantic-components.md
@src/app/verification/integration-v2.tsx
@src/app/release/release.command.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add render props pattern to echo-agent</name>
  <files>src/app/scenarios/5.1-echo-agent.tsx</files>
  <action>
Update file header comment to document v2.0 features demonstrated, specifically the render props pattern.

Modify the Agent to use render props pattern for context access:

```tsx
// Before:
export default function EchoAgent() {
  return (
    <Agent
      name="5.1-echo-agent"
      description="..."
    >
      <h1>Echo Agent</h1>
      ...
    </Agent>
  );
}

// After:
export default function EchoAgent() {
  return (
    <Agent
      name="5.1-echo-agent"
      description="..."
    >
      {(ctx) => (
        <>
          <h1>Echo Agent</h1>

          <p>Agent: {ctx.name}</p>
          <p>Model: {ctx.model || 'default'}</p>

          ...rest of content...
        </>
      )}
    </Agent>
  );
}
```

This demonstrates the render props pattern in an Agent context (success criteria: render props in at least one Command AND one Agent).

Also add List component for any bullet lists in the file.
  </action>
  <verify>npm run build && grep -q "{(ctx) =>" src/app/scenarios/5.1-echo-agent.tsx</verify>
  <done>5.1-echo-agent.tsx demonstrates render props pattern in Agent</done>
</task>

<task type="auto">
  <name>Task 2: Modernize release command with OfferNext and Table</name>
  <files>src/app/release/release.command.tsx</files>
  <action>
Update file header comment to document v2.0 features demonstrated.

Add to imports: `import { ..., Table, List, OfferNext, ExecutionContext, SuccessCriteria } from '../../jsx.js';`

1. Add ExecutionContext at the top of the command content:
```tsx
<ExecutionContext paths={[
  "src/app/release/version-analyzer.agent.tsx",
  "src/app/release/changelog-generator.agent.tsx",
  "src/app/release/release-validator.agent.tsx",
]} />
```

2. Replace the manual `<offer_next>` XmlBlock with OfferNext component:
```tsx
// Before:
<XmlBlock name="offer_next">
  <Markdown>{`... manual markdown ...`}</Markdown>
</XmlBlock>

// After:
<OfferNext routes={[
  {
    name: "View Release",
    path: "git show v$VERSION",
    description: "Show the release tag details",
  },
  {
    name: "Push Tag",
    path: "git push origin v$VERSION",
    description: "Push tag to remote if not auto-pushed",
  },
  {
    name: "View Changelog",
    path: "cat CHANGELOG.md",
    description: "Display the changelog",
  },
]} />
```

3. Replace the manual `<success_criteria>` XmlBlock with SuccessCriteria component:
```tsx
// Before:
<XmlBlock name="success_criteria">
  <ul>
    <li>[ ] SQLite database initialized...</li>
    ...
  </ul>
</XmlBlock>

// After:
<SuccessCriteria items={[
  "SQLite database initialized with tables",
  "Last version retrieved from database",
  "Commit history gathered",
  "version-analyzer spawned and returned version",
  "changelog-generator spawned and created entry",
  "release-validator spawned and all checks passed (or user override)",
  "Git tag created (unless dry-run)",
  "Release recorded in SQLite (unless dry-run)",
  "User sees complete summary",
]} />
```

4. Replace the flags list in `<XmlBlock name="context">` with List component:
```tsx
<List items={[
  "--major — Force major version bump",
  "--minor — Force minor version bump",
  "--patch — Force patch version bump",
  "--skip-tests — Skip test validation",
  "--skip-build — Skip build validation",
  "--dry-run — Don't tag or record, just show what would happen",
]} />
```
  </action>
  <verify>npm run build && grep -q "&lt;OfferNext" src/app/release/release.command.tsx</verify>
  <done>release.command.tsx uses OfferNext, SuccessCriteria, ExecutionContext, List, and Table</done>
</task>

<task type="auto">
  <name>Task 3: Enhance test-render-props with context interpolation</name>
  <files>src/app/test-render-props.tsx</files>
  <action>
Update file header comment to document v2.0 features demonstrated.

Enhance the existing render props example to actually interpolate context values:

```tsx
// Before:
export default function TestRenderProps() {
  return (
    <Command name="test-render-props" description="Test render props pattern">
      {(ctx) => (
        <>
          <h1>Render Props Test</h1>
          <Markdown>...</Markdown>
          <h2>Context Values</h2>
          <p>Command name and description are available in the output.</p>
        </>
      )}
    </Command>
  );
}

// After:
import { Command, Markdown, Table, List, ExecutionContext } from '../jsx.js';

export default function TestRenderProps() {
  return (
    <Command name="test-render-props" description="Test render props pattern">
      {(ctx) => (
        <>
          <h1>Render Props Test</h1>

          <Markdown>
This command uses the render props pattern to access context.
The context parameter `ctx` gives access to command metadata.
          </Markdown>

          <h2>Context Values</h2>

          <Table
            headers={["Property", "Value"]}
            rows={[
              ["name", ctx.name],
              ["description", ctx.description],
              ["outputPath", ctx.outputPath],
              ["sourcePath", ctx.sourcePath],
            ]}
          />

          <h2>Features Demonstrated</h2>

          <List items={[
            "Render props pattern {(ctx) => ...}",
            "Context interpolation in content",
            "Table component with context values",
            "List component for feature enumeration",
          ]} />

          <ExecutionContext paths={["docs/semantic-components.md"]} />
        </>
      )}
    </Command>
  );
}
```

This makes the test file a comprehensive demonstration of render props with v2.0 components.
  </action>
  <verify>npm run build && grep -q "ctx.name" src/app/test-render-props.tsx</verify>
  <done>test-render-props.tsx is a comprehensive render props demo with v2.0 components</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Run `npm run build` - should complete without errors
2. Run `node dist/cli/index.js build src/app/scenarios/5.1-echo-agent.tsx` - verify Agent with render props
3. Run `node dist/cli/index.js build src/app/release/release.command.tsx` - verify OfferNext and semantic output
4. Run `node dist/cli/index.js build src/app/test-render-props.tsx` - verify context interpolation works
</verification>

<success_criteria>
- [ ] All updated files build successfully
- [ ] Render props pattern demonstrated in Agent (5.1-echo-agent.tsx)
- [ ] OfferNext component used in release command
- [ ] Table component used with context values in test-render-props.tsx
- [ ] Each updated file has v2.0 feature documentation in header comment
- [ ] Phase 25 success criteria from ROADMAP met (all 6 items)
</success_criteria>

<output>
After completion, create `.planning/phases/25-tsx-test-modernization/25-03-SUMMARY.md`
</output>

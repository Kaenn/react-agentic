---
phase: 26-parser-refactoring
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/parser/utils/project.ts
  - src/parser/utils/jsx-traversal.ts
  - src/parser/utils/text-extraction.ts
  - src/parser/utils/spread-resolution.ts
  - src/parser/utils/component-resolution.ts
  - src/parser/utils/type-resolution.ts
  - src/parser/utils/variable-extraction.ts
  - src/parser/utils/index.ts
autonomous: true

must_haves:
  truths:
    - "All parser.ts utility functions are split into focused modules"
    - "utils/index.ts barrel exports all public functions"
    - "TypeScript compiler accepts all new files without errors"
  artifacts:
    - path: "src/parser/utils/project.ts"
      provides: "createProject, parseFile, parseSource"
      min_lines: 30
    - path: "src/parser/utils/jsx-traversal.ts"
      provides: "getElementName, getAttributeValue, getTestAttributeValue"
      min_lines: 150
    - path: "src/parser/utils/text-extraction.ts"
      provides: "extractText, extractInlineText, normalizeWhitespace"
      min_lines: 50
    - path: "src/parser/utils/spread-resolution.ts"
      provides: "resolveSpreadAttribute, extractObjectLiteralProps"
      min_lines: 60
    - path: "src/parser/utils/component-resolution.ts"
      provides: "resolveComponentImport, extractJsxFromComponent"
      min_lines: 100
    - path: "src/parser/utils/type-resolution.ts"
      provides: "resolveTypeImport, extractInterfaceProperties"
      min_lines: 120
    - path: "src/parser/utils/variable-extraction.ts"
      provides: "extractVariableDeclarations, extractTypeArguments, analyzeRenderPropsChildren"
      min_lines: 200
    - path: "src/parser/utils/index.ts"
      provides: "Barrel exports for all utilities"
      min_lines: 40
  key_links:
    - from: "src/parser/utils/index.ts"
      to: "src/parser/utils/*.ts"
      via: "re-exports"
      pattern: "export.*from.*\\.js"
---

<objective>
Split parser.ts (1255 lines) into focused utility modules in src/parser/utils/

Purpose: Improve code organization and maintainability by grouping related parser utilities
Output: 8 new files in utils/ directory with all parser.ts functions extracted
</objective>

<execution_context>
@/Users/glenninizan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/glenninizan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/26-parser-refactoring/26-RESEARCH.md
@src/parser/parser.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create utils/ directory with project and JSX traversal modules</name>
  <files>
    src/parser/utils/project.ts
    src/parser/utils/jsx-traversal.ts
    src/parser/utils/text-extraction.ts
  </files>
  <action>
Create src/parser/utils/ directory and extract parser.ts utilities into focused modules:

1. **utils/project.ts** (~50 lines):
   - Move CreateProjectOptions interface
   - Move createProject function
   - Move parseFile function
   - Move parseSource function
   - Import from ts-morph: Project, SourceFile, ScriptTarget, ModuleKind, ts

2. **utils/jsx-traversal.ts** (~250 lines):
   - Move getElementName function
   - Move JsxChild type alias
   - Move getJsxChildren function
   - Move getAttributeValue function
   - Move getTestAttributeValue function (includes TEST_HELPERS, evaluateTestHelperCall, resolveVariableArg, evaluateTestArg)
   - Move getArrayAttributeValue function
   - Move findRootJsxElement function
   - Import ExtractedVariable type from variable-extraction.ts (forward reference - define minimal type inline for now, will be imported properly in index.ts)

3. **utils/text-extraction.ts** (~60 lines):
   - Move isWhitespaceOnlyText function
   - Move normalizeWhitespace function
   - Move normalizeInlineWhitespace function
   - Move extractText function
   - Move extractInlineText function

All files must use `.js` extensions in imports for NodeNext compliance.
All exports must be named exports (not default).
  </action>
  <verify>
    `npx tsc --noEmit src/parser/utils/project.ts src/parser/utils/jsx-traversal.ts src/parser/utils/text-extraction.ts` passes
  </verify>
  <done>
    Three utils files created with all project/traversal/text functions extracted from parser.ts
  </done>
</task>

<task type="auto">
  <name>Task 2: Create spread, component, and type resolution modules</name>
  <files>
    src/parser/utils/spread-resolution.ts
    src/parser/utils/component-resolution.ts
    src/parser/utils/type-resolution.ts
  </files>
  <action>
Continue extracting parser.ts utilities:

1. **utils/spread-resolution.ts** (~90 lines):
   - Move extractObjectLiteralProps function
   - Move resolveSpreadAttribute function
   - Import from ts-morph: Node, JsxSpreadAttribute, ObjectLiteralExpression, SyntaxKind

2. **utils/component-resolution.ts** (~170 lines):
   - Move ResolvedComponent interface
   - Move resolveComponentImport function
   - Move extractJsxFromComponent function
   - Import from ts-morph: Node, JsxElement, JsxSelfClosingElement, JsxFragment, SourceFile

3. **utils/type-resolution.ts** (~180 lines):
   - Move ResolvedType interface
   - Move resolveTypeImport function
   - Move InterfaceProperty interface
   - Move extractInterfaceProperties function
   - Move extractPromptPlaceholders function
   - Import from ts-morph: Node, SourceFile, InterfaceDeclaration

All files must use `.js` extensions in imports for NodeNext compliance.
  </action>
  <verify>
    `npx tsc --noEmit src/parser/utils/spread-resolution.ts src/parser/utils/component-resolution.ts src/parser/utils/type-resolution.ts` passes
  </verify>
  <done>
    Three more utils files created with spread/component/type resolution functions
  </done>
</task>

<task type="auto">
  <name>Task 3: Create variable extraction module and utils barrel export</name>
  <files>
    src/parser/utils/variable-extraction.ts
    src/parser/utils/index.ts
  </files>
  <action>
Complete utils/ directory:

1. **utils/variable-extraction.ts** (~350 lines):
   - Move ExtractedVariable interface
   - Move extractVariableDeclarations function
   - Move InputProperty and InputPropertyValue types (import from ir/nodes.js)
   - Move isVariableRef function
   - Move extractInputObjectLiteral function
   - Move StateSchema and StateSchemaField types (import from ir/nodes.js)
   - Move mapTsTypeToSql helper
   - Move getDefaultValue helper
   - Move extractEnumValues helper
   - Move extractStateSchema function
   - Move extractSqlArguments function
   - Move extractTypeArguments function
   - Move RenderPropsInfo interface
   - Move analyzeRenderPropsChildren function
   - Import from ts-morph: Node, SourceFile, JsxElement, JsxSelfClosingElement, SyntaxKind, ArrowFunction

2. **utils/index.ts** (barrel exports):
   Create barrel file re-exporting all public APIs:
   ```typescript
   // Project creation and parsing
   export { createProject, parseFile, parseSource, type CreateProjectOptions } from './project.js';

   // JSX traversal
   export { getElementName, getJsxChildren, getAttributeValue, getArrayAttributeValue, getTestAttributeValue, findRootJsxElement, type JsxChild } from './jsx-traversal.js';

   // Text extraction
   export { extractText, extractInlineText, normalizeWhitespace, normalizeInlineWhitespace, isWhitespaceOnlyText } from './text-extraction.js';

   // Spread resolution
   export { resolveSpreadAttribute, extractObjectLiteralProps } from './spread-resolution.js';

   // Component resolution
   export { resolveComponentImport, extractJsxFromComponent, type ResolvedComponent } from './component-resolution.js';

   // Type resolution
   export { resolveTypeImport, extractInterfaceProperties, extractPromptPlaceholders, type ResolvedType, type InterfaceProperty } from './type-resolution.js';

   // Variable and state extraction
   export { extractVariableDeclarations, extractTypeArguments, analyzeRenderPropsChildren, extractInputObjectLiteral, extractStateSchema, extractSqlArguments, isVariableRef, type ExtractedVariable, type RenderPropsInfo } from './variable-extraction.js';
   ```

Verify TypeScript compilation of all utils/ files.
  </action>
  <verify>
    `npx tsc --noEmit src/parser/utils/index.ts` passes (implicitly validates all utils modules)
  </verify>
  <done>
    utils/ directory complete with all parser.ts functions extracted and barrel exports configured
  </done>
</task>

</tasks>

<verification>
After all tasks:
1. All 8 utils/ files exist with proper TypeScript
2. utils/index.ts exports all public APIs
3. `npx tsc --noEmit` passes for src/parser/utils/
4. No runtime changes yet - parser.ts not yet modified to use utils/
</verification>

<success_criteria>
- [ ] src/parser/utils/ directory created with 8 files
- [ ] All parser.ts utility functions extracted to appropriate modules
- [ ] Barrel exports in utils/index.ts
- [ ] TypeScript compilation passes for all new files
- [ ] NodeNext .js extensions used in all imports
</success_criteria>

<output>
After completion, create `.planning/phases/26-parser-refactoring/26-01-SUMMARY.md`
</output>

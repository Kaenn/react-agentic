---
phase: 17-state-system
plan: 04
type: execute
wave: 2
depends_on: ["17-01"]
files_modified:
  - src/emitter/emitter.ts
autonomous: true

must_haves:
  truths:
    - "ReadStateNode emits as CLI skill invocation"
    - "WriteStateNode field mode emits field-specific write"
    - "WriteStateNode merge mode emits merge operation"
    - "Emitter uses /react-agentic:state-read skill syntax"
    - "Emitter uses /react-agentic:state-write skill syntax"
  artifacts:
    - path: "src/emitter/emitter.ts"
      provides: "emitReadState and emitWriteState methods"
      contains: "emitReadState"
  key_links:
    - from: "src/emitter/emitter.ts"
      to: "src/ir/nodes.ts"
      via: "switch case handling"
      pattern: "case 'readState'"
---

<objective>
Add emitter logic to convert ReadState and WriteState IR nodes to markdown.

Purpose: Generate CLI skill invocations for state operations
Output: Emitter produces skill-based state read/write instructions
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/17-state-system/17-CONTEXT.md

# Plan 01 outputs
@src/ir/nodes.ts

# Existing emitter patterns
@src/emitter/emitter.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add ReadState emitter method</name>
  <files>src/emitter/emitter.ts</files>
  <action>
Add `emitReadState` method following the `emitAssign` pattern:

```typescript
/**
 * Emit ReadState node as skill invocation
 *
 * Output format varies by whether field is specified:
 * - Full state: Use /react-agentic:state-read {key} and store in variable
 * - Field read: Use /react-agentic:state-read {key} --field {path}
 */
private emitReadState(node: ReadStateNode): string {
  const { stateKey, variableName, field } = node;

  if (field) {
    // Read specific field
    return `Use skill \`/react-agentic:state-read ${stateKey} --field "${field}"\` and store result in \`${variableName}\`.`;
  } else {
    // Read full state
    return `Use skill \`/react-agentic:state-read ${stateKey}\` and store result in \`${variableName}\`.`;
  }
}
```

Add case to `emitBlock` switch statement:
```typescript
case 'readState':
  return this.emitReadState(node);
```

Import `ReadStateNode` type in the file if not auto-imported.
  </action>
  <verify>Run `npx tsc --noEmit` - no type errors in emitter.ts</verify>
  <done>emitReadState generates skill invocation for state reads</done>
</task>

<task type="auto">
  <name>Task 2: Add WriteState emitter method</name>
  <files>src/emitter/emitter.ts</files>
  <action>
Add `emitWriteState` method:

```typescript
/**
 * Emit WriteState node as skill invocation
 *
 * Output format varies by mode:
 * - Field mode: /react-agentic:state-write {key} --field {path} --value {val}
 * - Merge mode: /react-agentic:state-write {key} --merge '{json}'
 */
private emitWriteState(node: WriteStateNode): string {
  const { stateKey, mode, field, value } = node;

  if (mode === 'field') {
    // Field write mode
    const valueStr = value.type === 'variable'
      ? `$${value.content}`
      : `"${value.content}"`;
    return `Use skill \`/react-agentic:state-write ${stateKey} --field "${field}" --value ${valueStr}\`.`;
  } else {
    // Merge mode
    const mergeJson = value.content;
    return `Use skill \`/react-agentic:state-write ${stateKey} --merge '${mergeJson}'\`.`;
  }
}
```

Add case to `emitBlock` switch statement:
```typescript
case 'writeState':
  return this.emitWriteState(node);
```

Import `WriteStateNode` type in the file if not auto-imported.
  </action>
  <verify>Run `npx tsc --noEmit` - no type errors in emitter.ts</verify>
  <done>emitWriteState generates skill invocation for field and merge writes</done>
</task>

</tasks>

<verification>
```bash
# Type check passes
npx tsc --noEmit

# New emit methods exist
grep -n "emitReadState\|emitWriteState" src/emitter/emitter.ts

# Switch cases added
grep -n "case 'readState'\|case 'writeState'" src/emitter/emitter.ts

# Skill invocation format
grep -n "react-agentic:state-read\|react-agentic:state-write" src/emitter/emitter.ts
```
</verification>

<success_criteria>
- [ ] emitReadState generates skill invocation with optional --field flag
- [ ] emitWriteState generates field mode with --field and --value flags
- [ ] emitWriteState generates merge mode with --merge flag and JSON
- [ ] Variable references in value emit as $VARIABLE_NAME
- [ ] Switch statement handles both new node kinds
- [ ] TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/17-state-system/17-04-SUMMARY.md`
</output>

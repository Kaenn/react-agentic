---
phase: 07-example-validation
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/parser/transformer.ts
  - tests/parser/transformer.test.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Space between bold text and following content is preserved in list items"
    - "Test verifies `<li><b>label:</b> value</li>` produces `- **label:** value`"
  artifacts:
    - path: "src/parser/transformer.ts"
      provides: "List item transformation with space preservation"
      contains: "extractInlineText(child)"
    - path: "tests/parser/transformer.test.ts"
      provides: "Test case for space preservation in list items"
      contains: "preserves space between bold and following text"
  key_links:
    - from: "src/parser/transformer.ts:335"
      to: "extractInlineText"
      via: "function call"
      pattern: "extractInlineText\\(child\\)"
---

<objective>
Fix the remaining gap: space lost between bold text and following content in list items.

Purpose: Complete phase 7 verification by fixing the last remaining gap where `<li><b>label:</b> text</li>` incorrectly renders as `- **label:**text` instead of `- **label:** text`.

Output: Corrected transformer that preserves leading spaces in list item text nodes, verified by test.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-example-validation/07-VERIFICATION.md

@src/parser/transformer.ts
@src/parser/parser.ts
@tests/parser/transformer.test.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix extractText to extractInlineText in transformListItem</name>
  <files>src/parser/transformer.ts</files>
  <action>
Change line 335 from:
```typescript
const text = extractText(child);
```
to:
```typescript
const text = extractInlineText(child);
```

This is a single-line change. The `extractInlineText` function is already imported at line 30.

Rationale: `extractText()` calls `normalizeWhitespace()` which trims leading/trailing spaces. `extractInlineText()` preserves leading spaces, which is required to maintain the space between `**bold:**` and `text` in list items.
  </action>
  <verify>Run `npm run typecheck` to confirm no TypeScript errors</verify>
  <done>Line 335 uses `extractInlineText(child)` instead of `extractText(child)`</done>
</task>

<task type="auto">
  <name>Task 2: Update test expectation and add explicit space preservation test</name>
  <files>tests/parser/transformer.test.ts</files>
  <action>
1. Update the existing test at line ~452-459 to expect the leading space:
   Change `{ kind: 'text', value: 'text' }` to `{ kind: 'text', value: ' text' }` (note leading space)

2. Add a new test case specifically for the gap scenario:

```typescript
it('preserves space between bold and following text in list items', () => {
  const tsx = `export default function Doc() {
    return (
      <ul>
        <li><b>Working directory:</b> Current git repository</li>
      </ul>
    );
  }`;
  const doc = transformTsx(tsx);

  const list = doc.children[0];
  expect(list.kind).toBe('list');
  if (list.kind === 'list') {
    expect(list.items[0]).toEqual({
      kind: 'listItem',
      children: [
        {
          kind: 'paragraph',
          children: [
            { kind: 'bold', children: [{ kind: 'text', value: 'Working directory:' }] },
            { kind: 'text', value: ' Current git repository' },
          ],
        },
      ],
    });
  }
});
```

Place this test in the existing 'list elements' describe block, after the 'transforms list item with inline formatting' test.
  </action>
  <verify>Run `npm test -- --run tests/parser/transformer.test.ts` and confirm all tests pass</verify>
  <done>Test suite includes explicit verification that space is preserved between bold text and following content</done>
</task>

</tasks>

<verification>
1. Run full test suite: `npm test`
2. Run transpilation on example: `node dist/cli/index.js build 'src/app/**/*.tsx'`
3. Check output: `cat .claude/commands/commit-helper.md | grep "Working directory"`
   - Expected: `- **Working directory:** Current git repository` (space after colon)
   - NOT: `- **Working directory:**Current git repository` (no space)
</verification>

<success_criteria>
1. All 154+ tests pass (including new space preservation test)
2. TypeScript type checking passes
3. Example transpilation produces correct output with space preserved
4. Gap from VERIFICATION.md is closed: criterion 6 fully verified
</success_criteria>

<output>
After completion, create `.planning/phases/07-example-validation/07-03-SUMMARY.md`
</output>

---
phase: 18-mcp-configuration
plan: 04
type: execute
wave: 4
depends_on: [18-03]
files_modified:
  - src/app/mcp/servers.mcp.tsx
  - docs/mcp-configuration.md
  - docs/README.md
autonomous: true

must_haves:
  truths:
    - "Example MCP config file demonstrates both stdio and http servers"
    - "Full build pipeline works end-to-end"
    - "Documentation covers component API and usage patterns"
    - "Generated settings.json matches Claude Code format"
  artifacts:
    - path: "src/app/mcp/servers.mcp.tsx"
      provides: "Example MCP configuration"
      contains: "MCPConfig"
    - path: "docs/mcp-configuration.md"
      provides: "MCP configuration documentation"
      contains: "MCPServer"
  key_links:
    - from: "docs/mcp-configuration.md"
      to: "src/app/mcp/servers.mcp.tsx"
      via: "Example reference"
      pattern: "mcp/servers"
---

<objective>
Create example MCP configuration files and documentation.

Purpose: Demonstrate the complete MCP configuration feature with working examples and comprehensive documentation that users can follow.

Output: Example MCP config TSX file, documentation in docs/, updated README
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/18-mcp-configuration/18-CONTEXT.md
@.planning/phases/18-mcp-configuration/18-RESEARCH.md
@.planning/phases/18-mcp-configuration/18-01-SUMMARY.md
@.planning/phases/18-mcp-configuration/18-02-SUMMARY.md
@.planning/phases/18-mcp-configuration/18-03-SUMMARY.md
@docs/README.md
@CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create example MCP configuration</name>
  <files>src/app/mcp/servers.mcp.tsx</files>
  <action>
Create directory `src/app/mcp/` if it doesn't exist.

Create example MCP configuration file demonstrating common patterns:

```tsx
/**
 * Example MCP Server Configuration
 *
 * This file demonstrates how to configure MCP servers using TSX.
 * Build with: node dist/cli/index.js build "src/app/mcp/*.tsx"
 * Output: .claude/settings.json (merged)
 */
import {
  MCPConfig,
  MCPStdioServer,
  MCPHTTPServer,
} from '../../jsx.js';

export default function Servers() {
  return (
    <MCPConfig>
      {/* SQLite database server - stdio transport */}
      <MCPStdioServer
        name="sqlite"
        command="npx"
        args={["-y", "@anthropic/mcp-server-sqlite", "--db-path", "./data/app.db"]}
        env={{ DEBUG: "false" }}
      />

      {/* Filesystem server - provides read/write access to project files */}
      <MCPStdioServer
        name="filesystem"
        command="npx"
        args={["-y", "@anthropic/mcp-server-filesystem", "--root", "."]}
      />

      {/* Example HTTP server (commented - uncomment to use)
      <MCPHTTPServer
        name="remote-api"
        url="https://api.example.com/mcp"
        headers={{ "Authorization": "Bearer ${API_KEY}" }}
      />
      */}
    </MCPConfig>
  );
}
```

Also create a simpler single-server example:

```tsx
// src/app/mcp/playwright.mcp.tsx
/**
 * Playwright MCP Server Configuration
 */
import { MCPConfig, MCPStdioServer } from '../../jsx.js';

export default function PlaywrightServer() {
  return (
    <MCPConfig>
      <MCPStdioServer
        name="playwright"
        command="npx"
        args={["-y", "@anthropic/mcp-server-playwright"]}
      />
    </MCPConfig>
  );
}
```

Verify build works:
```bash
node dist/cli/index.js build "src/app/mcp/*.tsx"
cat .claude/settings.json
```

Expected output structure:
```json
{
  "mcpServers": {
    "sqlite": {
      "type": "stdio",
      "command": "npx",
      "args": ["-y", "@anthropic/mcp-server-sqlite", "--db-path", "./data/app.db"],
      "env": { "DEBUG": "false" }
    },
    "filesystem": {
      "type": "stdio",
      "command": "npx",
      "args": ["-y", "@anthropic/mcp-server-filesystem", "--root", "."]
    },
    "playwright": {
      "type": "stdio",
      "command": "npx",
      "args": ["-y", "@anthropic/mcp-server-playwright"]
    }
  }
}
```
  </action>
  <verify>
1. `npm run build` compiles without errors
2. `node dist/cli/index.js build "src/app/mcp/*.tsx"` succeeds
3. `.claude/settings.json` exists with correct mcpServers structure
4. JSON is valid and matches Claude Code format
  </verify>
  <done>
Example MCP configuration files exist demonstrating stdio and http patterns. Build produces valid settings.json.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create MCP configuration documentation</name>
  <files>docs/mcp-configuration.md, docs/README.md</files>
  <action>
Create comprehensive documentation for MCP configuration feature.

**Create docs/mcp-configuration.md:**

```markdown
# MCP Server Configuration

Configure MCP (Model Context Protocol) servers using TSX. Build compiles to Claude Code's `.claude/settings.json` format.

## Quick Start

```tsx
// src/app/mcp/servers.mcp.tsx
import { MCPConfig, MCPStdioServer } from 'react-agentic';

export default function Servers() {
  return (
    <MCPConfig>
      <MCPStdioServer
        name="sqlite"
        command="npx"
        args={["-y", "@anthropic/mcp-server-sqlite", "--db-path", "./data/app.db"]}
      />
    </MCPConfig>
  );
}
```

Build and verify:

```bash
node dist/cli/index.js build "src/app/mcp/*.tsx"
cat .claude/settings.json
```

## Components

### MCPConfig

Wrapper component containing MCP server definitions. Required as root element.

```tsx
<MCPConfig>
  {/* MCPServer, MCPStdioServer, or MCPHTTPServer children */}
</MCPConfig>
```

### MCPStdioServer

Type-safe stdio server definition. Use for local MCP servers.

| Prop | Type | Required | Description |
|------|------|----------|-------------|
| `name` | string | Yes | Server identifier (key in settings.json) |
| `command` | string | Yes | Executable command |
| `args` | string[] | No | Command arguments |
| `env` | object | No | Environment variables |

```tsx
<MCPStdioServer
  name="sqlite"
  command="npx"
  args={["-y", "@anthropic/mcp-server-sqlite", "--db-path", "./data/app.db"]}
  env={{ DEBUG: "true" }}
/>
```

### MCPHTTPServer

Type-safe HTTP server definition. Use for remote MCP servers.

| Prop | Type | Required | Description |
|------|------|----------|-------------|
| `name` | string | Yes | Server identifier |
| `url` | string | Yes | Remote server URL |
| `headers` | object | No | HTTP headers |

```tsx
<MCPHTTPServer
  name="remote-api"
  url="https://api.example.com/mcp"
  headers={{ "Authorization": "Bearer ${API_KEY}" }}
/>
```

### MCPServer (Generic)

Generic component supporting all transport types. Use when you need explicit type control.

| Prop | Type | Required | Description |
|------|------|----------|-------------|
| `name` | string | Yes | Server identifier |
| `type` | 'stdio' \| 'http' \| 'sse' | Yes | Transport type |
| `command` | string | stdio only | Executable command |
| `args` | string[] | No | Command arguments |
| `url` | string | http/sse only | Remote URL |
| `headers` | object | No | HTTP headers |
| `env` | object | No | Environment variables |

## Output Format

Build produces `.claude/settings.json`:

```json
{
  "mcpServers": {
    "sqlite": {
      "type": "stdio",
      "command": "npx",
      "args": ["-y", "@anthropic/mcp-server-sqlite", "--db-path", "./data/app.db"],
      "env": { "DEBUG": "true" }
    }
  }
}
```

## Merge Behavior

- **TSX wins on conflicts:** TSX-defined servers overwrite existing entries with same name
- **Other settings preserved:** Only `mcpServers` section is modified
- **Multiple files merge:** All MCP config files combine into single settings.json

## Environment Variables

Environment variables in `env` prop can reference `process.env`:

```tsx
<MCPStdioServer
  name="database"
  command="npx"
  args={["-y", "mcp-server-postgres"]}
  env={{
    DATABASE_URL: process.env.DATABASE_URL,  // Resolved at build time
    DEBUG: "false",                           // Literal value
  }}
/>
```

**Build fails if referenced env var is undefined.**

## File Organization

Recommended structure:

```
src/app/mcp/
├── servers.mcp.tsx     # Main MCP servers
├── database.mcp.tsx    # Database-related servers
└── testing.mcp.tsx     # Testing/dev servers
```

All `.tsx` files in `src/app/mcp/` are processed and merged into single `settings.json`.

## Common Patterns

### SQLite Database

```tsx
<MCPStdioServer
  name="sqlite"
  command="npx"
  args={["-y", "@anthropic/mcp-server-sqlite", "--db-path", "./data/app.db"]}
/>
```

### Filesystem Access

```tsx
<MCPStdioServer
  name="filesystem"
  command="npx"
  args={["-y", "@anthropic/mcp-server-filesystem", "--root", "."]}
/>
```

### Playwright Browser

```tsx
<MCPStdioServer
  name="playwright"
  command="npx"
  args={["-y", "@anthropic/mcp-server-playwright"]}
/>
```

### Remote API

```tsx
<MCPHTTPServer
  name="api"
  url="https://api.example.com/mcp"
  headers={{ "Authorization": "Bearer ${API_KEY}" }}
/>
```

## Compile-Time Validation

The build will fail with helpful errors for:

- Missing required props (`name`, `command` for stdio, `url` for http)
- Invalid prop combinations (`type="stdio"` with `url` prop)
- Undefined environment variables in `env` prop

## See Also

- [Claude Code MCP Documentation](https://docs.anthropic.com/en/docs/claude-code/mcp)
- [MCP Protocol Specification](https://modelcontextprotocol.io/)
```

**Update docs/README.md:**

Add to the User Guides table:

```markdown
| [MCP Configuration](mcp-configuration.md) | Configure MCP servers via TSX |
```
  </action>
  <verify>
1. docs/mcp-configuration.md exists with complete documentation
2. docs/README.md updated with link to new doc
3. Documentation examples match actual component API
4. All code examples are syntactically correct
  </verify>
  <done>
Documentation covers all MCP components, props, output format, merge behavior, and common patterns. README updated with link.
  </done>
</task>

<task type="auto">
  <name>Task 3: End-to-end verification</name>
  <files>N/A (verification only)</files>
  <action>
Run complete verification of the MCP configuration feature:

1. **Build the compiler:**
   ```bash
   npm run build
   ```

2. **Build example MCP configs:**
   ```bash
   node dist/cli/index.js build "src/app/mcp/*.tsx"
   ```

3. **Verify settings.json structure:**
   ```bash
   cat .claude/settings.json | jq .mcpServers
   ```
   Should show all configured servers with correct format.

4. **Test merge behavior:**
   - Manually add `"permissions": {}` to settings.json
   - Rebuild
   - Verify permissions key is preserved

5. **Test validation:**
   Create invalid config (temporarily):
   ```tsx
   <MCPStdioServer name="bad" command="npx" url="invalid" />
   ```
   Build should fail with clear error message.

6. **Verify dry-run:**
   ```bash
   node dist/cli/index.js build "src/app/mcp/*.tsx" --dry-run
   ```
   Should show what would be written without modifying files.

Document any issues found and resolve them.
  </action>
  <verify>
1. All builds pass
2. settings.json has correct structure
3. Merge preserves existing content
4. Invalid configs fail with helpful errors
5. Dry-run works correctly
  </verify>
  <done>
End-to-end MCP configuration feature works: TSX compiles to valid settings.json with merge semantics and compile-time validation.
  </done>
</task>

</tasks>

<verification>
1. Example MCP config files build successfully
2. Generated settings.json matches Claude Code format
3. Documentation is complete and accurate
4. Merge behavior preserves existing settings
5. Compile-time validation catches errors
</verification>

<success_criteria>
- Example files demonstrate stdio and http server patterns
- Build produces valid .claude/settings.json
- Documentation covers all components and patterns
- End-to-end workflow verified
- Feature ready for v1.7 release
</success_criteria>

<output>
After completion, create `.planning/phases/18-mcp-configuration/18-04-SUMMARY.md`
</output>

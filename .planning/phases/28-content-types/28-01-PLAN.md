---
phase: 28-content-types
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/ir/content-types.ts
  - src/ir/index.ts
  - src/index.ts
  - tests/ir/content-types.test.ts
autonomous: true

must_haves:
  truths:
    - "User can type component children with CommandContent for full feature set"
    - "User can type component children with AgentContent for full feature set"
    - "User can type component children with SubComponentContent for restricted subset"
    - "TypeScript rejects SpawnAgentNode assignment to SubComponentContent"
  artifacts:
    - path: "src/ir/content-types.ts"
      provides: "Content type discriminated unions"
      exports: ["CommandContent", "AgentContent", "SubComponentContent"]
    - path: "tests/ir/content-types.test.ts"
      provides: "Type assignment validation tests"
      min_lines: 50
  key_links:
    - from: "src/ir/content-types.ts"
      to: "src/ir/nodes.ts"
      via: "imports BaseBlockNode types"
      pattern: "import.*from.*nodes"
    - from: "src/ir/content-types.ts"
      to: "src/ir/runtime-nodes.ts"
      via: "imports RuntimeBlockNode types"
      pattern: "import.*from.*runtime-nodes"
    - from: "src/index.ts"
      to: "src/ir/content-types.ts"
      via: "re-exports content types"
      pattern: "export.*type.*CommandContent"
---

<objective>
Define content type discriminated unions that enable TypeScript compile-time errors when users misuse components in different contexts (Command vs Agent vs SubComponent).

Purpose: Establishes the type foundation for Phase 31 content validation - users can type their custom component children props to get compile-time safety.

Output:
- `src/ir/content-types.ts` with CommandContent, AgentContent, SubComponentContent types
- Types exported from root `react-agentic` package
- Tests validating type assignment behavior
</objective>

<execution_context>
@/Users/glenninizan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/glenninizan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-content-types/28-CONTEXT.md
@.planning/phases/28-content-types/28-RESEARCH.md
@src/ir/nodes.ts
@src/ir/runtime-nodes.ts
@src/ir/index.ts
@src/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create content-types.ts with discriminated union types</name>
  <files>src/ir/content-types.ts</files>
  <action>
Create `src/ir/content-types.ts` with three content type discriminated unions:

1. **CommandContent** - Full feature set for Command context:
   - Import BaseBlockNode from ./nodes.js
   - Import RuntimeBlockNode from ./runtime-nodes.js
   - Define as union: `BaseBlockNode | RuntimeBlockNode`
   - Add JSDoc explaining this allows all primitives including SpawnAgent, control flow

2. **AgentContent** - Full feature set for Agent context:
   - Same definition as CommandContent: `BaseBlockNode | RuntimeBlockNode`
   - Separate type to allow future divergence
   - Add JSDoc explaining this allows all primitives including control flow

3. **SubComponentContent** - Restricted subset for nested components:
   - Import specific node types that ARE allowed:
     - HeadingNode, ParagraphNode, ListNode, CodeBlockNode, BlockquoteNode
     - ThematicBreakNode, TableNode, ExecutionContextNode, SuccessCriteriaNode
     - OfferNextNode, XmlBlockNode, GroupNode, RawMarkdownNode, IndentNode, StepNode
   - DO NOT include: SpawnAgentNode, OnStatusNode, IfNode, ElseNode, LoopNode, BreakNode, ReturnNode, AskUserNode, RuntimeVarDeclNode, RuntimeCallNode
   - Add JSDoc explaining the restriction and why (document-level only features)

Use the existing `kind` discriminant pattern. The types are pure unions without additional structure.

Include header comment explaining purpose: "Content types for constraining what components are valid in different contexts."
  </action>
  <verify>
Run `npx tsc --noEmit` to verify file compiles without errors.
  </verify>
  <done>
File exists with three exported types: CommandContent, AgentContent, SubComponentContent. All imports resolve correctly. TypeScript compilation succeeds.
  </done>
</task>

<task type="auto">
  <name>Task 2: Export content types from IR and root package</name>
  <files>src/ir/index.ts, src/index.ts</files>
  <action>
1. Update `src/ir/index.ts`:
   - Add re-export for content types:
     ```typescript
     export type {
       CommandContent,
       AgentContent,
       SubComponentContent,
     } from './content-types.js';
     ```
   - Place after existing registry exports

2. Update `src/index.ts`:
   - The `export * from './ir/index.js'` already exists, which will include the content types
   - Verify the content types are accessible via the package root

Note: Since index.ts uses `export *`, the content types will be automatically re-exported once they're in ir/index.ts. No additional changes needed to src/index.ts beyond verification.
  </action>
  <verify>
Create a temporary TypeScript file that imports from the package root:
```typescript
import type { CommandContent, AgentContent, SubComponentContent } from './src/index.js';
```
Run `npx tsc --noEmit` on it.
  </verify>
  <done>
Content types are importable from both `react-agentic/ir` and `react-agentic` root. TypeScript sees all three types with correct definitions.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add content type tests</name>
  <files>tests/ir/content-types.test.ts</files>
  <action>
Create `tests/ir/content-types.test.ts` with type-level tests validating the discriminated unions:

1. **Type assignment tests** (compile-time validation):
   - Test that ParagraphNode is assignable to all three types
   - Test that HeadingNode is assignable to all three types
   - Test that TableNode is assignable to all three types
   - Test that SpawnAgentNode is assignable to CommandContent and AgentContent
   - Test that SpawnAgentNode is NOT assignable to SubComponentContent (type error expected)
   - Test that IfNode is NOT assignable to SubComponentContent
   - Test that OnStatusNode is NOT assignable to SubComponentContent

2. **Union completeness tests** (runtime verification):
   - Verify CommandContent includes all expected node kinds
   - Verify AgentContent includes all expected node kinds
   - Verify SubComponentContent excludes runtime/control-flow nodes

Use `describe` blocks:
- "CommandContent type"
- "AgentContent type"
- "SubComponentContent type"
- "Type exclusions"

For type-level tests that verify assignment FAILS, use TypeScript's `@ts-expect-error` comment directive to ensure the type error exists. These tests verify the type system itself, not runtime behavior.

Example pattern for type exclusion tests:
```typescript
it('should not allow SpawnAgentNode in SubComponentContent', () => {
  // This is a compile-time test - the @ts-expect-error ensures the assignment fails
  const spawn: SpawnAgentNode = { kind: 'spawnAgent', agent: 'test', model: 'sonnet', description: 'test' };
  // @ts-expect-error - SpawnAgentNode is not assignable to SubComponentContent
  const content: SubComponentContent = spawn;
  // If this compiles WITHOUT the @ts-expect-error, the test file itself will fail to compile
});
```
  </action>
  <verify>
Run `npm test tests/ir/content-types.test.ts` - all tests pass.
Verify @ts-expect-error comments are triggered (meaning the type errors DO occur).
  </verify>
  <done>
Test file exists with comprehensive type assignment tests. All tests pass. Type exclusions verified via @ts-expect-error directives.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Type definitions exist:**
   ```bash
   grep -l "CommandContent\|AgentContent\|SubComponentContent" src/ir/content-types.ts
   ```

2. **Exports work:**
   ```bash
   grep "content-types" src/ir/index.ts
   ```

3. **Tests pass:**
   ```bash
   npm test tests/ir/content-types.test.ts
   ```

4. **Build succeeds:**
   ```bash
   npm run build
   ```

5. **Type restrictions verified:**
   - The @ts-expect-error directives in tests prove SpawnAgentNode cannot be assigned to SubComponentContent
</verification>

<success_criteria>
- [ ] `src/ir/content-types.ts` exists with CommandContent, AgentContent, SubComponentContent types
- [ ] All three types are discriminated unions based on node `kind`
- [ ] SubComponentContent excludes SpawnAgentNode, OnStatusNode, and control flow nodes
- [ ] Types exported from `react-agentic` package root
- [ ] Tests verify type assignment behavior (including expected failures)
- [ ] Build passes with no TypeScript errors
- [ ] All 155+ existing tests still pass
</success_criteria>

<output>
After completion, create `.planning/phases/28-content-types/28-01-SUMMARY.md`
</output>

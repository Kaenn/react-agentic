---
phase: 32-composite-library
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/composites/index.ts
  - package.json
  - tsconfig.json
autonomous: true

must_haves:
  truths:
    - "Composites directory exists with index.ts barrel export"
    - "Package.json exports field includes ./composites subpath"
    - "Import from 'react-agentic/composites' resolves types correctly"
  artifacts:
    - path: "src/composites/index.ts"
      provides: "Barrel export for all composites"
      min_lines: 5
    - path: "package.json"
      provides: "Subpath exports configuration"
      contains: "./composites"
  key_links:
    - from: "package.json"
      to: "src/composites/index.ts"
      via: "exports field ./composites"
      pattern: '"./composites".*"types".*"default"'
---

<objective>
Create composites directory infrastructure with package.json subpath exports

Purpose: Establish the foundation for composite components with proper module resolution so `import { ... } from 'react-agentic/composites'` works correctly.

Output: Empty composites directory with barrel export, package.json with subpath export configuration.
</objective>

<execution_context>
@/Users/glenninizan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/glenninizan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/32-composite-library/32-CONTEXT.md
@.planning/phases/32-composite-library/32-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create composites directory with barrel export</name>
  <files>src/composites/index.ts</files>
  <action>
Create the src/composites/ directory and add an initial index.ts barrel export file.

First, create the directory:
```bash
mkdir -p src/composites
```

Then create the index.ts barrel export file.

The index.ts should:
1. Have a header comment explaining composites are user-definable convenience wrappers
2. Include placeholder export comment: `// Composites will be exported here`
3. Export an empty object for now to avoid "module has no exports" error:
   `export {};`

This file will be populated with actual exports as composites are created in subsequent plans.

File content:
```typescript
/**
 * react-agentic/composites - User-definable convenience wrappers
 *
 * Composites wrap primitives to provide enhanced variants with common patterns.
 * Users can import these for "batteries included" behavior, or copy/modify
 * the source code to create custom variants.
 *
 * Import: import { IfElseBlock, LoopWithBreak } from 'react-agentic/composites'
 */

// Composites will be exported here as they are created
export {};
```
  </action>
  <verify>
File exists: `ls src/composites/index.ts`
TypeScript compiles: `npx tsc --noEmit src/composites/index.ts`
  </verify>
  <done>src/composites/index.ts exists with barrel export stub</done>
</task>

<task type="auto">
  <name>Task 2: Configure package.json subpath exports</name>
  <files>package.json</files>
  <action>
Update package.json exports field to include ./composites subpath.

Current exports:
```json
"exports": {
  ".": {
    "import": "./dist/index.js",
    "types": "./dist/index.d.ts"
  }
}
```

Add ./composites entry with "types" BEFORE "default" (critical for TypeScript resolution):
```json
"exports": {
  ".": {
    "types": "./dist/index.d.ts",
    "import": "./dist/index.js"
  },
  "./composites": {
    "types": "./dist/composites/index.d.ts",
    "import": "./dist/composites/index.js"
  }
}
```

Note: Also fix root export to put "types" before "import" (correct order per Node.js/TypeScript convention).

Also add composites to the "files" array to ensure it's included in npm publish:
```json
"files": [
  "dist",
  "README.md",
  "LICENSE"
]
```
This is already correct since "dist" includes dist/composites/.
  </action>
  <verify>
JSON is valid: `node -e "require('./package.json')"`
Exports field contains ./composites: `cat package.json | grep -A4 '"./composites"'`
  </verify>
  <done>package.json exports field includes ./composites subpath with correct types/import order</done>
</task>

<task type="auto">
  <name>Task 3: Build and verify subpath resolution</name>
  <files>-</files>
  <action>
Build the project and verify the subpath export resolves correctly.

Steps:
1. Run build: `npm run build`
2. Verify dist/composites/index.js exists
3. Verify dist/composites/index.d.ts exists
4. Create a quick TypeScript test to verify import resolution works

For verification, create a temporary test file (delete after verification):
```typescript
// test-import.ts (temporary)
import {} from './dist/composites/index.js';
```

Run TypeScript on it to verify resolution:
`npx tsc --noEmit test-import.ts --moduleResolution bundler --module ESNext`

Then delete the temporary file.
  </action>
  <verify>
Build succeeds: `npm run build` exits 0
dist/composites/index.js exists: `ls dist/composites/index.js`
dist/composites/index.d.ts exists: `ls dist/composites/index.d.ts`
All tests pass: `npm run test:run`
  </verify>
  <done>Subpath export builds correctly and TypeScript can resolve it</done>
</task>

</tasks>

<verification>
1. Directory structure: src/composites/index.ts exists
2. Package.json: exports field has ./composites with types before import
3. Build output: dist/composites/index.js and dist/composites/index.d.ts exist
4. TypeScript: `npx tsc --noEmit` passes
5. Tests: `npm run test:run` passes (existing tests still work)
</verification>

<success_criteria>
- [ ] src/composites/index.ts exists with barrel export structure
- [ ] package.json exports field includes ./composites subpath
- [ ] npm run build succeeds with dist/composites/ output
- [ ] All existing tests pass (849+)
</success_criteria>

<output>
After completion, create `.planning/phases/32-composite-library/32-01-SUMMARY.md`
</output>

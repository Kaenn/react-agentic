---
phase: 34-agent-contract-components
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/ir/nodes.ts
  - src/components/contract.ts
  - src/components/index.ts
  - src/jsx.ts
autonomous: true

must_haves:
  truths:
    - "New IR node types exist for Role, UpstreamInput, DownstreamConsumer, Methodology, StructuredReturns, Return"
    - "TSX components exist with proper TypeScript types for all contract components"
    - "Components are exported from jsx.ts for user consumption"
  artifacts:
    - path: "src/ir/nodes.ts"
      provides: "Contract IR node types"
      contains: "RoleNode, UpstreamInputNode, DownstreamConsumerNode, MethodologyNode, StructuredReturnsNode, ReturnNode"
    - path: "src/components/contract.ts"
      provides: "Contract component stubs and types"
      exports: ["Role", "UpstreamInput", "DownstreamConsumer", "Methodology", "StructuredReturns", "Return"]
  key_links:
    - from: "src/components/index.ts"
      to: "src/components/contract.ts"
      via: "re-export"
      pattern: "export.*from.*contract"
---

# Plan 34-01: IR Node Types and Component Stubs

<objective>
Add IR node type definitions and TSX component stubs for agent contract components: Role, UpstreamInput, DownstreamConsumer, Methodology, StructuredReturns, and Return.

Purpose: Create the foundation types that parser and emitter will use. Components must exist before transformation can reference them.
Output: IR node types in nodes.ts, component stubs in contract.ts, exports in index.ts and jsx.ts.
</objective>

<execution_context>
@/Users/glenninizan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/glenninizan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/34-agent-contract-components/34-CONTEXT.md
@.planning/phases/34-agent-contract-components/34-RESEARCH.md

Source files:
@src/ir/nodes.ts
@src/components/Agent.ts
@src/components/index.ts
@src/jsx.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add IR Node Types</name>
  <files>src/ir/nodes.ts</files>
  <action>
Add the following IR node types after the existing OnStatusNode (around line 276):

```typescript
/**
 * Role - agent identity and responsibilities
 * Renders as <role> XML block
 */
export interface RoleNode {
  kind: 'role';
  children: BaseBlockNode[];
}

/**
 * UpstreamInput - documents expected input context
 * Renders as <upstream_input> XML block
 */
export interface UpstreamInputNode {
  kind: 'upstreamInput';
  children: BaseBlockNode[];
}

/**
 * DownstreamConsumer - documents output consumers
 * Renders as <downstream_consumer> XML block
 */
export interface DownstreamConsumerNode {
  kind: 'downstreamConsumer';
  children: BaseBlockNode[];
}

/**
 * Methodology - describes working approach
 * Renders as <methodology> XML block
 */
export interface MethodologyNode {
  kind: 'methodology';
  children: BaseBlockNode[];
}

/**
 * Return - individual return status with description
 * Only valid inside StructuredReturns
 */
export interface ReturnNode {
  kind: 'return';
  status: string;
  children: BaseBlockNode[];
}

/**
 * StructuredReturns - container for Return children
 * Renders as <structured_returns> with ## headings for each status
 */
export interface StructuredReturnsNode {
  kind: 'structuredReturns';
  returns: ReturnNode[];
}
```

Add these node types to the BaseBlockNode union (around line 365-388):
```typescript
export type BaseBlockNode =
  | HeadingNode
  | ParagraphNode
  // ... existing types ...
  | StepNode
  | RoleNode
  | UpstreamInputNode
  | DownstreamConsumerNode
  | MethodologyNode
  | StructuredReturnsNode;
  // Note: ReturnNode is NOT in BaseBlockNode - it's only valid inside StructuredReturns
```

Export the new types from the union of all IR nodes (around line 607):
```typescript
export type IRNode =
  | BlockNode
  | InlineNode
  // ... existing types ...
  | RoleNode
  | UpstreamInputNode
  | DownstreamConsumerNode
  | MethodologyNode
  | StructuredReturnsNode
  | ReturnNode
  | TypeReference;
```
  </action>
  <verify>
```bash
cd /Users/glenninizan/workspace/react-agentic/react-agentic && npm run build 2>&1 | head -50
```
Build should succeed. If there are errors, check node kind strings match in type guards.
  </verify>
  <done>IR node types for all 6 contract components exist in nodes.ts and are included in BaseBlockNode and IRNode unions</done>
</task>

<task type="auto">
  <name>Task 2: Create Contract Component Stubs</name>
  <files>src/components/contract.ts</files>
  <action>
Create new file `src/components/contract.ts` with component stubs:

```typescript
/**
 * Agent Contract Components - Compile-time JSX components
 *
 * These components define the agent's contract: identity, inputs, outputs,
 * methodology, and structured return statuses. They render as XML blocks
 * in the agent markdown output.
 *
 * All components are optional but must appear in order if used:
 * Role → UpstreamInput → DownstreamConsumer → Methodology → StructuredReturns
 */

import type { ReactNode } from 'react';

// ============================================================================
// Types
// ============================================================================

/**
 * Props for container contract components (Role, UpstreamInput, etc.)
 * These accept free-form children - author decides internal structure
 */
export interface ContractComponentProps {
  /** Free-form content: markdown, XmlBlock, text */
  children?: ReactNode;
}

/**
 * Props for Return component
 */
export interface ReturnProps {
  /** Status value (e.g., "SUCCESS", "BLOCKED", "PARTIAL") */
  status: string;
  /** Description of what this status means */
  children?: ReactNode;
}

/**
 * Props for StructuredReturns component
 */
export interface StructuredReturnsProps {
  /** Return children defining each status */
  children?: ReactNode;
}

// ============================================================================
// Components
// ============================================================================

/**
 * Role - Declares agent identity and responsibilities
 *
 * Renders as <role> XML block in agent markdown.
 *
 * @example
 * ```tsx
 * <Role>
 *   You are a test runner. You execute tests and report results.
 * </Role>
 * ```
 */
export function Role(_props: ContractComponentProps): null {
  return null;
}

/**
 * UpstreamInput - Documents expected input context from orchestrator
 *
 * Renders as <upstream_input> XML block in agent markdown.
 *
 * @example
 * ```tsx
 * <UpstreamInput>
 *   Expects:
 *   - testPath: string
 *   - coverage: boolean
 * </UpstreamInput>
 * ```
 */
export function UpstreamInput(_props: ContractComponentProps): null {
  return null;
}

/**
 * DownstreamConsumer - Documents output consumers
 *
 * Renders as <downstream_consumer> XML block in agent markdown.
 *
 * @example
 * ```tsx
 * <DownstreamConsumer>
 *   Output is consumed by the orchestrator for status routing.
 * </DownstreamConsumer>
 * ```
 */
export function DownstreamConsumer(_props: ContractComponentProps): null {
  return null;
}

/**
 * Methodology - Describes working approach
 *
 * Renders as <methodology> XML block in agent markdown.
 *
 * @example
 * ```tsx
 * <Methodology>
 *   1. Load test files
 *   2. Execute test runner
 *   3. Parse results
 *   4. Report status
 * </Methodology>
 * ```
 */
export function Methodology(_props: ContractComponentProps): null {
  return null;
}

/**
 * Return - Individual return status with description
 *
 * Only valid inside StructuredReturns. Renders as ## heading in agent markdown.
 *
 * @example
 * ```tsx
 * <Return status="SUCCESS">All tests passed</Return>
 * ```
 */
export function Return(_props: ReturnProps): null {
  return null;
}

/**
 * StructuredReturns - Container for Return children defining agent statuses
 *
 * Renders as <structured_returns> XML block containing ## headings for each status.
 * Must document all statuses from agent's status type.
 *
 * @example
 * ```tsx
 * <StructuredReturns>
 *   <Return status="SUCCESS">All tests passed</Return>
 *   <Return status="FAILED">Some tests failed</Return>
 *   <Return status="BLOCKED">Cannot run tests</Return>
 * </StructuredReturns>
 * ```
 */
export function StructuredReturns(_props: StructuredReturnsProps): null {
  return null;
}
```
  </action>
  <verify>
```bash
cd /Users/glenninizan/workspace/react-agentic/react-agentic && npx tsc --noEmit 2>&1 | head -20
```
TypeScript should compile without errors.
  </verify>
  <done>Contract component stubs exist with proper TypeScript types</done>
</task>

<task type="auto">
  <name>Task 3: Export Components from Index Files</name>
  <files>src/components/index.ts, src/jsx.ts</files>
  <action>
In `src/components/index.ts`, add a new section for contract components (after the Control Flow section):

```typescript
// ============================================================================
// Agent Contract Components
// ============================================================================

export {
  Role,
  UpstreamInput,
  DownstreamConsumer,
  Methodology,
  Return,
  StructuredReturns,
  type ContractComponentProps,
  type ReturnProps,
  type StructuredReturnsProps,
} from './contract.js';
```

In `src/jsx.ts`, add to the core components import (around line 14-101):

After the existing imports from './components/index.js', add these to the export list:
```typescript
// Contract components (add to existing export block)
Role,
UpstreamInput,
DownstreamConsumer,
Methodology,
Return,
StructuredReturns,

// Types (add to type exports)
type ContractComponentProps,
type ReturnProps,
type StructuredReturnsProps,
```
  </action>
  <verify>
```bash
cd /Users/glenninizan/workspace/react-agentic/react-agentic && npm run build && node -e "const j = require('./dist/jsx.js'); console.log('Role:', typeof j.Role, 'StructuredReturns:', typeof j.StructuredReturns)"
```
Should output: Role: function StructuredReturns: function
  </verify>
  <done>Contract components are exported from jsx.ts and available to users</done>
</task>

</tasks>

<verification>
After all tasks complete, verify:

```bash
cd /Users/glenninizan/workspace/react-agentic/react-agentic

# Build succeeds
npm run build

# Types exist in built output
grep -l "RoleNode" dist/ir/nodes.d.ts
grep -l "StructuredReturnsNode" dist/ir/nodes.d.ts

# Components are exported
node -e "const j = require('./dist/jsx.js'); console.log(Object.keys(j).filter(k => ['Role', 'UpstreamInput', 'DownstreamConsumer', 'Methodology', 'Return', 'StructuredReturns'].includes(k)))"
```

Expected:
- Build succeeds with no errors
- IR node types are in compiled output
- All 6 contract components are exported
</verification>

<success_criteria>
- [ ] IR nodes.ts has RoleNode, UpstreamInputNode, DownstreamConsumerNode, MethodologyNode, ReturnNode, StructuredReturnsNode
- [ ] contract.ts exists with component stubs and TypeScript types
- [ ] Components are exported from components/index.ts
- [ ] Components are re-exported from jsx.ts
- [ ] npm run build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/34-agent-contract-components/34-01-SUMMARY.md`
</output>

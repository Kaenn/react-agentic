---
phase: 38-data-abstraction
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/primitives/sources.ts
  - src/index.ts
  - src/jsx.ts
  - tests/grammar/SourceHelpers/sources.test.ts
autonomous: true

must_haves:
  truths:
    - "file() returns FileSource with __sourceType: 'file'"
    - "bash() returns BashSource with __sourceType: 'bash'"
    - "value() returns ValueSource with __sourceType: 'value'"
    - "env() returns EnvSource with __sourceType: 'env'"
    - "Source types are exported and usable in TSX files"
  artifacts:
    - path: "src/primitives/sources.ts"
      provides: "Source helper functions and types"
      exports: ["file", "bash", "value", "env", "FileSource", "BashSource", "ValueSource", "EnvSource", "AssignSource", "isFileSource", "isBashSource", "isValueSource", "isEnvSource"]
    - path: "tests/grammar/SourceHelpers/sources.test.ts"
      provides: "Unit tests for source helper functions"
  key_links:
    - from: "src/jsx.ts"
      to: "src/primitives/sources.ts"
      via: "re-export"
      pattern: "export.*from.*sources"
---

<objective>
Create source helper functions (`file()`, `bash()`, `value()`, `env()`) that return typed source objects for use with the new `<Assign from={...}>` pattern.

Purpose: Enable a consistent, composable API for data sources that can be validated at compile-time.
Output: Source helper module with typed exports, ready for transformer integration.
</objective>

<execution_context>
@/Users/glenninizan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/glenninizan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/38-data-abstraction/38-CONTEXT.md
@.planning/phases/38-data-abstraction/38-RESEARCH.md
@src/primitives/variables.ts
@src/components/runtime-fn.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create source helper types and functions</name>
  <files>src/primitives/sources.ts</files>
  <action>
Create `src/primitives/sources.ts` with:

1. **Source Type Interfaces** (branded with `__sourceType` discriminator):
```typescript
export interface FileSource {
  __sourceType: 'file';
  path: string;
  optional?: boolean;
}

export interface BashSource {
  __sourceType: 'bash';
  command: string;
}

export interface ValueSource {
  __sourceType: 'value';
  value: string;
  raw?: boolean;
}

export interface EnvSource {
  __sourceType: 'env';
  envVar: string;
}

export type AssignSource = FileSource | BashSource | ValueSource | EnvSource;
```

2. **Helper Functions** (pure functions returning typed objects):
- `file(path: string, options?: { optional?: boolean }): FileSource`
- `bash(command: string): BashSource`
- `value(val: string, options?: { raw?: boolean }): ValueSource`
- `env(varName: string): EnvSource`

3. **Type Guards** (for transformer/emitter use):
- `isFileSource(source: unknown): source is FileSource`
- `isBashSource(source: unknown): source is BashSource`
- `isValueSource(source: unknown): source is ValueSource`
- `isEnvSource(source: unknown): source is EnvSource`
- `isAssignSource(source: unknown): source is AssignSource`

Follow existing code style from variables.ts (JSDoc comments, compile-time only stubs).
  </action>
  <verify>TypeScript compiles with `npm run build`</verify>
  <done>sources.ts exists with all 4 source types, 4 helper functions, and 5 type guards exported</done>
</task>

<task type="auto">
  <name>Task 2: Export source helpers from module index</name>
  <files>src/jsx.ts, src/index.ts</files>
  <action>
1. In `src/jsx.ts`, add export for source helpers:
```typescript
export { file, bash, value, env } from './primitives/sources.js';
export type { FileSource, BashSource, ValueSource, EnvSource, AssignSource } from './primitives/sources.js';
```

2. In `src/index.ts`, ensure sources are re-exported:
```typescript
export { file, bash, value, env } from './primitives/sources.js';
export type { FileSource, BashSource, ValueSource, EnvSource, AssignSource } from './primitives/sources.js';
```

Place exports after existing primitives exports (near useVariable, Assign, etc.).
  </action>
  <verify>`npm run build` succeeds</verify>
  <done>source helpers importable from 'react-agentic' package</done>
</task>

<task type="auto">
  <name>Task 3: Create unit tests for source helpers</name>
  <files>tests/grammar/SourceHelpers/sources.test.ts</files>
  <action>
Create test file `tests/grammar/SourceHelpers/sources.test.ts` with:

1. **Type correctness tests** (each helper returns correct __sourceType):
```typescript
it('file() returns FileSource', () => {
  const source = file('.planning/STATE.md');
  expect(source.__sourceType).toBe('file');
  expect(source.path).toBe('.planning/STATE.md');
});
```

2. **Options handling tests**:
- `file('path', { optional: true })` sets optional flag
- `value('str', { raw: true })` sets raw flag
- Options are optional (no error when omitted)

3. **Type guard tests**:
- `isFileSource()` returns true for file(), false for others
- Same for all 4 type guards
- `isAssignSource()` returns true for all source types, false for random objects

Follow existing test patterns in tests/grammar/ directory.
  </action>
  <verify>`npm test tests/grammar/SourceHelpers/sources.test.ts` passes</verify>
  <done>All source helper tests pass</done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. `npm test tests/grammar/SourceHelpers/sources.test.ts` passes
3. Source helpers are importable in TSX files
</verification>

<success_criteria>
- [ ] src/primitives/sources.ts exists with 4 source types, 4 helpers, 5 type guards
- [ ] Exports added to src/jsx.ts and src/index.ts
- [ ] Unit tests cover all source helpers and type guards
- [ ] All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/38-data-abstraction/38-01-SUMMARY.md`
</output>

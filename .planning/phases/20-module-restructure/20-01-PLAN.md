---
phase: 20-module-restructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/primitives/markdown.ts
  - src/primitives/variables.ts
  - src/primitives/control.ts
  - src/workflow/Command.ts
  - src/workflow/agents/Agent.ts
  - src/workflow/agents/types.ts
  - src/workflow/agents/index.ts
  - src/workflow/state/State.ts
  - src/workflow/state/ReadState.ts
  - src/workflow/state/WriteState.ts
  - src/workflow/state/types.ts
  - src/workflow/state/index.ts
  - src/workflow/skill/Skill.ts
  - src/workflow/skill/index.ts
  - src/workflow/mcp/MCP.ts
  - src/workflow/mcp/index.ts
  - src/workflow/sections/index.ts
autonomous: true

must_haves:
  truths:
    - "primitives/ directory exists with markdown, variables, and control components"
    - "workflow/ directory exists with Command, agents/, state/, skill/, mcp/, sections/ structure"
    - "All components from jsx.ts are migrated to their new locations"
    - "All internal imports use .js extensions (NodeNext requirement)"
  artifacts:
    - path: "src/primitives/markdown.ts"
      provides: "Markdown and XmlBlock components with Props types"
      exports: ["Markdown", "XmlBlock", "MarkdownProps", "XmlBlockProps"]
    - path: "src/primitives/variables.ts"
      provides: "useVariable hook, Assign component, VariableRef type"
      exports: ["useVariable", "Assign", "VariableRef", "AssignProps"]
    - path: "src/primitives/control.ts"
      provides: "If, Else components and test builders"
      exports: ["If", "Else", "fileExists", "dirExists", "isEmpty", "notEmpty", "equals", "and", "or"]
    - path: "src/workflow/Command.ts"
      provides: "Command component"
      exports: ["Command", "CommandProps"]
    - path: "src/workflow/agents/index.ts"
      provides: "Agent system barrel exports"
      exports: ["Agent", "SpawnAgent", "OnStatus", "useOutput"]
    - path: "src/workflow/state/index.ts"
      provides: "State system barrel exports"
      exports: ["State", "Operation", "ReadState", "WriteState", "useStateRef"]
    - path: "src/workflow/skill/index.ts"
      provides: "Skill system barrel exports"
      exports: ["Skill", "SkillFile", "SkillStatic"]
    - path: "src/workflow/mcp/index.ts"
      provides: "MCP system barrel exports"
      exports: ["MCPServer", "MCPStdioServer", "MCPHTTPServer", "MCPConfig"]
    - path: "src/workflow/sections/index.ts"
      provides: "Empty placeholder for Phase 22 semantic components"
      exports: []
  key_links:
    - from: "src/primitives/control.ts"
      to: "src/primitives/variables.ts"
      via: "import VariableRef type"
      pattern: "from.*variables\\.js"
    - from: "src/workflow/agents/Agent.ts"
      to: "src/primitives/variables.ts"
      via: "import VariableRef type"
      pattern: "from.*primitives/variables\\.js"
    - from: "src/workflow/state/ReadState.ts"
      to: "src/primitives/variables.ts"
      via: "import VariableRef type"
      pattern: "from.*primitives/variables\\.js"
---

<objective>
Create the new directory structure and migrate all components from jsx.ts to their organized locations.

Purpose: Establish the primitives/ and workflow/ module organization that enables clean component placement for Phase 22 semantic components and beyond.
Output: 17 new files across primitives/ and workflow/ directories with all component code migrated from jsx.ts.
</objective>

<execution_context>
@/Users/glenninizan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/glenninizan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-module-restructure/20-CONTEXT.md
@.planning/phases/20-module-restructure/20-RESEARCH.md
@src/jsx.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create primitives/ directory with all primitive components</name>
  <files>
    src/primitives/markdown.ts
    src/primitives/variables.ts
    src/primitives/control.ts
  </files>
  <action>
Create src/primitives/ directory and three files:

**markdown.ts** - Extract from jsx.ts lines 89-182:
- MarkdownProps interface
- XmlBlockProps interface
- Markdown function component
- XmlBlock function component
- Include JSDoc comments

**variables.ts** - Extract from jsx.ts lines 214-284:
- VariableRef interface (generic)
- AssignProps interface
- useVariable function (generic)
- Assign function component
- Include JSDoc comments

**control.ts** - Extract from jsx.ts lines 411-579:
- IfProps interface
- ElseProps interface
- If function component
- Else function component
- fileExists, dirExists, isEmpty, notEmpty, equals, and, or test builder functions
- Import VariableRef from './variables.js' (NodeNext .js extension)
- Include JSDoc comments

All files must:
- Use `import type { ReactNode } from 'react';` where needed
- Export all types and functions
- Match existing code exactly (no logic changes)
- Use lowercase filenames (html-like convention for primitives)
  </action>
  <verify>
Files exist and contain expected exports:
```bash
ls src/primitives/
grep "export function Markdown" src/primitives/markdown.ts
grep "export function useVariable" src/primitives/variables.ts
grep "export function If" src/primitives/control.ts
grep "from.*variables\\.js" src/primitives/control.ts
```
  </verify>
  <done>
Three primitive files created with all primitive components migrated. Each file exports its components and types. control.ts imports VariableRef from variables.js using NodeNext .js extension.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create workflow/ directory with all workflow components</name>
  <files>
    src/workflow/Command.ts
    src/workflow/agents/Agent.ts
    src/workflow/agents/types.ts
    src/workflow/agents/index.ts
    src/workflow/state/State.ts
    src/workflow/state/ReadState.ts
    src/workflow/state/WriteState.ts
    src/workflow/state/types.ts
    src/workflow/state/index.ts
    src/workflow/skill/Skill.ts
    src/workflow/skill/index.ts
    src/workflow/mcp/MCP.ts
    src/workflow/mcp/index.ts
    src/workflow/sections/index.ts
  </files>
  <action>
Create src/workflow/ directory with subdirectories and files:

**Command.ts** (flat at workflow/ level) - Extract from jsx.ts lines 13-119:
- CommandProps interface
- Command function component

**agents/Agent.ts** - Extract from jsx.ts lines 29-205, 375-406:
- AgentProps interface (generic TInput, TOutput)
- SpawnAgentProps interface (generic TInput)
- OnStatusProps interface
- AllowVariableRefs utility type
- Agent function component (generic)
- SpawnAgent function component (generic)
- OnStatus function component
- Import VariableRef from '../../primitives/variables.js'

**agents/types.ts** - Extract from jsx.ts lines 286-373:
- AgentStatus type union
- BaseOutput interface
- OutputRef interface (generic)
- useOutput function (generic)

**agents/index.ts** - Barrel exports:
```typescript
export { Agent, SpawnAgent, OnStatus } from './Agent.js';
export type { AgentProps, SpawnAgentProps, OnStatusProps } from './Agent.js';
export { useOutput } from './types.js';
export type { OutputRef, AgentStatus, BaseOutput } from './types.js';
```

**state/State.ts** - Extract from jsx.ts lines 810-898:
- SQLiteConfig interface
- StateProps interface (generic)
- OperationProps interface
- State function component (generic)
- Operation function component

**state/ReadState.ts** - Extract from jsx.ts lines 765-785:
- ReadStateProps interface (generic)
- ReadState function component (generic)
- Import VariableRef from '../../primitives/variables.js'

**state/WriteState.ts** - Extract from jsx.ts lines 750-808:
- WriteStateProps interface (generic)
- WriteState function component (generic)
- Import VariableRef from '../../primitives/variables.js'

**state/types.ts** - Extract from jsx.ts lines 698-732:
- StateRef interface (generic)
- useStateRef function (generic)

**state/index.ts** - Barrel exports:
```typescript
export { State, Operation } from './State.js';
export type { StateProps, OperationProps, SQLiteConfig } from './State.js';
export { ReadState } from './ReadState.js';
export type { ReadStateProps } from './ReadState.js';
export { WriteState } from './WriteState.js';
export type { WriteStateProps } from './WriteState.js';
export { useStateRef } from './types.js';
export type { StateRef } from './types.js';
```

**skill/Skill.ts** - Extract from jsx.ts lines 582-696:
- SkillProps interface
- SkillFileProps interface
- SkillStaticProps interface
- Skill function component
- SkillFile function component
- SkillStatic function component

**skill/index.ts** - Barrel exports:
```typescript
export { Skill, SkillFile, SkillStatic } from './Skill.js';
export type { SkillProps, SkillFileProps, SkillStaticProps } from './Skill.js';
```

**mcp/MCP.ts** - Extract from jsx.ts lines 900-1043:
- MCPServerProps interface
- MCPStdioServerProps interface
- MCPHTTPServerProps interface
- MCPConfigProps interface
- MCPServer function component
- MCPStdioServer function component
- MCPHTTPServer function component
- MCPConfig function component

**mcp/index.ts** - Barrel exports:
```typescript
export { MCPServer, MCPStdioServer, MCPHTTPServer, MCPConfig } from './MCP.js';
export type { MCPServerProps, MCPStdioServerProps, MCPHTTPServerProps, MCPConfigProps } from './MCP.js';
```

**sections/index.ts** - Empty placeholder:
```typescript
// Placeholder for Phase 22 semantic components
// This file will re-export semantic wrapper components
export {};
```

All files must:
- Use PascalCase filenames (React convention for workflow)
- Use `.js` extensions in all imports (NodeNext requirement)
- Include JSDoc comments from original
- Match existing code exactly (no logic changes)
  </action>
  <verify>
Directory structure and exports exist:
```bash
ls -la src/workflow/
ls src/workflow/agents/
ls src/workflow/state/
ls src/workflow/skill/
ls src/workflow/mcp/
ls src/workflow/sections/
grep "export.*Agent" src/workflow/agents/index.ts
grep "export.*State" src/workflow/state/index.ts
```
  </verify>
  <done>
Workflow directory created with Command.ts at top level and agents/, state/, skill/, mcp/, sections/ subdirectories. Each subdirectory has an index.ts with barrel exports. All components migrated with JSDoc comments preserved.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. Directory structure correct:
```bash
ls src/primitives/  # Should show: markdown.ts, variables.ts, control.ts
ls src/workflow/    # Should show: Command.ts, agents/, state/, skill/, mcp/, sections/
```

2. All exports present in barrel files:
```bash
grep "export" src/workflow/agents/index.ts
grep "export" src/workflow/state/index.ts
grep "export" src/workflow/skill/index.ts
grep "export" src/workflow/mcp/index.ts
```

3. NodeNext .js extensions used:
```bash
grep "from '.*\.js'" src/primitives/control.ts
grep "from '.*\.js'" src/workflow/agents/Agent.ts
```

Note: Build and tests will fail until Plan 02 rewrites jsx.ts to re-export from these new locations.
</verification>

<success_criteria>
- 3 files in src/primitives/ (markdown.ts, variables.ts, control.ts)
- 14 files in src/workflow/ tree (Command.ts + 4 subdirs with 13 total files)
- All component code migrated with JSDoc comments preserved
- All internal imports use .js extensions
- Barrel exports (index.ts) in each workflow subdirectory
- sections/index.ts exists as empty placeholder
</success_criteria>

<output>
After completion, create `.planning/phases/20-module-restructure/20-01-SUMMARY.md`
</output>

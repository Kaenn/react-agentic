---
phase: 20-module-restructure
plan: 02
type: execute
wave: 2
depends_on: ["20-01"]
files_modified:
  - src/jsx.ts
autonomous: true

must_haves:
  truths:
    - "All existing imports from jsx.ts continue to work without modification"
    - "Build passes with no TypeScript errors"
    - "All tests pass"
    - "jsx.ts contains only re-exports, no component definitions"
  artifacts:
    - path: "src/jsx.ts"
      provides: "Central re-export point for all components"
      min_lines: 50
      max_lines: 150
  key_links:
    - from: "src/jsx.ts"
      to: "src/primitives/markdown.ts"
      via: "re-export"
      pattern: "from.*primitives/markdown\\.js"
    - from: "src/jsx.ts"
      to: "src/primitives/variables.ts"
      via: "re-export"
      pattern: "from.*primitives/variables\\.js"
    - from: "src/jsx.ts"
      to: "src/primitives/control.ts"
      via: "re-export"
      pattern: "from.*primitives/control\\.js"
    - from: "src/jsx.ts"
      to: "src/workflow/Command.ts"
      via: "re-export"
      pattern: "from.*workflow/Command\\.js"
    - from: "src/jsx.ts"
      to: "src/workflow/agents/index.ts"
      via: "re-export"
      pattern: "from.*workflow/agents/index\\.js"
    - from: "src/jsx.ts"
      to: "src/workflow/state/index.ts"
      via: "re-export"
      pattern: "from.*workflow/state/index\\.js"
    - from: "src/jsx.ts"
      to: "src/workflow/skill/index.ts"
      via: "re-export"
      pattern: "from.*workflow/skill/index\\.js"
    - from: "src/jsx.ts"
      to: "src/workflow/mcp/index.ts"
      via: "re-export"
      pattern: "from.*workflow/mcp/index\\.js"
---

<objective>
Rewrite jsx.ts to re-export all components from their new locations in primitives/ and workflow/.

Purpose: Complete the module restructure by making jsx.ts a pure re-export file, maintaining backward compatibility while enabling the new organization.
Output: Refactored jsx.ts (~100 lines of re-exports vs ~1044 lines of component code).
</objective>

<execution_context>
@/Users/glenninizan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/glenninizan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-module-restructure/20-CONTEXT.md
@.planning/phases/20-module-restructure/20-RESEARCH.md
@.planning/phases/20-module-restructure/20-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite jsx.ts with re-exports from new module locations</name>
  <files>src/jsx.ts</files>
  <action>
Replace the entire contents of jsx.ts with named re-exports from the new module structure.

Use explicit named re-exports (NOT `export *`) per research recommendations for API control and tree-shaking.

Structure (all imports use .js extension per NodeNext):

```typescript
/**
 * JSX component stubs for react-agentic
 *
 * These components are compile-time only - they're transformed by the transpiler
 * and never executed at runtime. They exist to provide TypeScript type checking.
 *
 * This file re-exports all components from their organized module locations.
 * For implementation details, see:
 * - src/primitives/ - Basic markdown building blocks
 * - src/workflow/ - Framework helpers for agentic flows
 */

// ============================================================================
// Primitives - Basic Markdown Building Blocks
// ============================================================================

// Markdown and XML components
export {
  Markdown,
  XmlBlock,
  type MarkdownProps,
  type XmlBlockProps,
} from './primitives/markdown.js';

// Variable system
export {
  useVariable,
  Assign,
  type VariableRef,
  type AssignProps,
} from './primitives/variables.js';

// Conditional logic and test builders
export {
  If,
  Else,
  fileExists,
  dirExists,
  isEmpty,
  notEmpty,
  equals,
  and,
  or,
  type IfProps,
  type ElseProps,
} from './primitives/control.js';

// ============================================================================
// Workflow - Framework Helpers for Agentic Flows
// ============================================================================

// Command component
export {
  Command,
  type CommandProps,
} from './workflow/Command.js';

// Agent system
export {
  Agent,
  SpawnAgent,
  OnStatus,
  useOutput,
  type AgentProps,
  type SpawnAgentProps,
  type OnStatusProps,
  type OutputRef,
  type AgentStatus,
  type BaseOutput,
} from './workflow/agents/index.js';

// State management
export {
  State,
  Operation,
  ReadState,
  WriteState,
  useStateRef,
  type StateProps,
  type OperationProps,
  type SQLiteConfig,
  type ReadStateProps,
  type WriteStateProps,
  type StateRef,
} from './workflow/state/index.js';

// Skill system
export {
  Skill,
  SkillFile,
  SkillStatic,
  type SkillProps,
  type SkillFileProps,
  type SkillStaticProps,
} from './workflow/skill/index.js';

// MCP configuration
export {
  MCPServer,
  MCPStdioServer,
  MCPHTTPServer,
  MCPConfig,
  type MCPServerProps,
  type MCPStdioServerProps,
  type MCPHTTPServerProps,
  type MCPConfigProps,
} from './workflow/mcp/index.js';
```

Key points:
- Use `type` keyword for type-only exports (TypeScript 5.x best practice)
- Maintain same export names as original jsx.ts (zero breaking changes)
- Group exports logically with section comments
- No `export * from` (per research: causes tree-shaking issues)
- All imports use `.js` extension (NodeNext requirement)
  </action>
  <verify>
Verify file structure and all exports present:
```bash
wc -l src/jsx.ts  # Should be ~80-100 lines (was 1044)
grep "export" src/jsx.ts | wc -l  # Should show many export statements
grep "from.*\.js" src/jsx.ts | wc -l  # Should show 8 imports (all with .js)
```
  </verify>
  <done>
jsx.ts rewritten as pure re-export file. Contains ~80-100 lines of organized re-exports instead of 1044 lines of component definitions. All imports use .js extensions.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify build passes and all tests pass</name>
  <files></files>
  <action>
Run TypeScript build and test suite to verify:
1. All module resolution works correctly
2. No circular dependencies
3. All existing imports continue to work
4. Tests pass without modification

Commands to run:
```bash
npm run build
npm test
```

If build fails, diagnose the error:
- Missing export: Add to the appropriate index.ts or source file
- Circular dependency: Check import order between primitives and workflow
- Module not found: Verify .js extension in import path

Expected: Both commands should pass with no errors.
  </action>
  <verify>
```bash
npm run build 2>&1 | tail -5  # Should show success
npm test 2>&1 | tail -10  # Should show all tests passing
```
  </verify>
  <done>
Build completes with no TypeScript errors. All tests pass. Module restructure is complete with zero breaking changes.
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify export count matches original</name>
  <files></files>
  <action>
Verify that all 56 exports from the original jsx.ts are still available.

Expected exports (grouped):

**Primitives (12 exports):**
- Markdown, MarkdownProps
- XmlBlock, XmlBlockProps
- useVariable, VariableRef, Assign, AssignProps
- If, Else, IfProps, ElseProps

**Test builders (7 exports):**
- fileExists, dirExists, isEmpty, notEmpty, equals, and, or

**Command (2 exports):**
- Command, CommandProps

**Agents (12 exports):**
- Agent, AgentProps
- SpawnAgent, SpawnAgentProps
- OnStatus, OnStatusProps
- useOutput, OutputRef
- AgentStatus, BaseOutput

**State (12 exports):**
- State, StateProps
- Operation, OperationProps
- SQLiteConfig
- ReadState, ReadStateProps
- WriteState, WriteStateProps
- useStateRef, StateRef

**Skill (6 exports):**
- Skill, SkillProps
- SkillFile, SkillFileProps
- SkillStatic, SkillStaticProps

**MCP (8 exports):**
- MCPServer, MCPServerProps
- MCPStdioServer, MCPStdioServerProps
- MCPHTTPServer, MCPHTTPServerProps
- MCPConfig, MCPConfigProps

Total: ~59 named exports (including types)

Run a quick sanity check that key exports are importable:
```bash
# Create a test import file
cat > /tmp/test-imports.ts << 'EOF'
import {
  // Primitives
  Markdown, XmlBlock, useVariable, Assign, If, Else,
  fileExists, dirExists, isEmpty, notEmpty, equals, and, or,
  // Workflow
  Command, Agent, SpawnAgent, OnStatus, useOutput,
  State, Operation, ReadState, WriteState, useStateRef,
  Skill, SkillFile, SkillStatic,
  MCPServer, MCPStdioServer, MCPHTTPServer, MCPConfig,
  // Types
  type CommandProps, type AgentProps, type VariableRef,
  type StateRef, type OutputRef, type BaseOutput,
} from './src/jsx.js';

// If this compiles, all exports work
console.log('All imports successful');
EOF

npx tsc --noEmit --moduleResolution NodeNext --module NodeNext /tmp/test-imports.ts
rm /tmp/test-imports.ts
```
  </action>
  <verify>
The test import file should compile without errors.
  </verify>
  <done>
All 59 exports from jsx.ts are available and importable. Zero breaking changes to the public API.
  </done>
</task>

</tasks>

<verification>
Final verification checklist:

1. **File structure:**
```bash
ls src/primitives/
# Expected: markdown.ts, variables.ts, control.ts

ls src/workflow/
# Expected: Command.ts, agents/, state/, skill/, mcp/, sections/
```

2. **Build passes:**
```bash
npm run build
# Expected: No errors
```

3. **Tests pass:**
```bash
npm test
# Expected: All tests pass
```

4. **jsx.ts is pure re-exports:**
```bash
wc -l src/jsx.ts
# Expected: ~80-100 lines (was 1044)

grep "function " src/jsx.ts | wc -l
# Expected: 0 (no function definitions, only re-exports)
```

5. **NodeNext compliance:**
```bash
grep "from '.*[^.][^j][^s]'" src/jsx.ts
# Expected: No output (all imports have .js extension)
```
</verification>

<success_criteria>
- jsx.ts reduced from 1044 lines to ~80-100 lines
- jsx.ts contains ONLY re-exports (no component/type definitions)
- `npm run build` passes with no errors
- `npm test` passes with no errors
- All 59 exports available (verified by test import)
- All imports use .js extension (NodeNext compliant)
</success_criteria>

<output>
After completion, create `.planning/phases/20-module-restructure/20-02-SUMMARY.md`
</output>
